<?php

namespace App\Http\Controllers;

use App\Models\County;
use App\Models\State;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Validator;

class CheckZipCodeController extends Controller
{

    public function checkZipCode(Request $request)
    {
        // $zipCode = $request->get("zip_code");

        // return response()->json([
        //     'status' => true,
        //     'message' => 'Not working',
        // ]);

        $zipCodes = [
            "21122",
            "21061",
            "21401",
            "21113",
            "21060",
            "21144",
            "21225",
            "21403",
            "20708",
            "21146",
            "20720",
            "21114",
            "21012",
            "21037",
            "20794",
            "21409",
            "21108",
            "21076",
            "20724",
            "21054",
            "20755",
            "21090",
            "21032",
            "21035",
            "20711",
            "21226",
            "20754",
            "20776",
            "21402",
            "20764",
            "20733",
            "21140",
            "20751",
            "20778",
            "20714",
            "20779",
            "20701",
            "21077",
            "20758",
            "21056",
            "21405",
            "21240",
            "21106",
            "20765",
            "21062",
            "21123",
            "21404",
            "21411",
            "21412",
            "21620",
            "21661",
            "21651",
            "21635",
            "21645",
            "21678",
            "21667",
            "21650",
            "21610",
            "21628",
            "21690",
            "21601",
            "21663",
            "21606",
            "21673",
            "21625",
            "21654",
            "21657",
            "21671",
            "21612",
            "21662",
            "21665",
            "21679",
            "21676",
            "21647",
            "21624",
            "21652",
            "21653",
            "21921",
            "21901",
            "21911",
            "21904",
            "21903",
            "21918",
            "21919",
            "21917",
            "21915",
            "21912",
            "21902",
            "21920",
            "21914",
            "21930",
            "21913",
            "21916",
            "21922",
            "21804",
            "21811",
            "21842",
            "21851",
            "21863",
            "21822",
            "21813",
            "21872",
            "21841",
            "21864",
            "21829",
            "21862",
            "21792",
            "21843",
            "21234",
            "21117",
            "21222",
            "21206",
            "21207",
            "21228",
            "21224",
            "21229",
            "21221",
            "21093",
            "21220",
            "21244",
            "21236",
            "21208",
            "21136",
            "21227",
            "21212",
            "21237",
            "21239",
            "21209",
            "21133",
            "21204",
            "21030",
            "21286",
            "21210",
            "21074",
            "21128",
            "21102",
            "21219",
            "21163",
            "21268",
            "21131",
            "21120",
            "21161",
            "21152",
            "21104",
            "21111",
            "21057",
            "21087",
            "21013",
            "21162",
            "21053",
            "21155",
            "21082",
            "21250",
            "21153",
            "21071",
            "21031",
            "21156",
            "21051",
            "21260",
            "21261",
            "21022",
            "21023",
            "21052",
            "21235",
            "21241",
            "21020",
            "21027",
            "21065",
            "21092",
            "21094",
            "21105",
            "21139",
            "21252",
            "21282",
            "21285",
            "21284",
            "21289",
            "21043",
            "21044",
            "21042",
            "21045",
            "21075",
            "21784",
            "20723",
            "21771",
            "20794",
            "21046",
            "21029",
            "21797",
            "20833",
            "21163",
            "20759",
            "21104",
            "20777",
            "20763",
            "21794",
            "21738",
            "21036",
            "21737",
            "21098",
            "20701",
            "21723",
            "21041",
            "21150",
            "21765",
            "19973",
            "21613",
            "21632",
            "21643",
            "21631",
            "21659",
            "21869",
            "21622",
            "21677",
            "21835",
            "21648",
            "21626",
            "21634",
            "21669",
            "21672",
            "21627",
            "21664",
            "21675",
            "21804",
            "21801",
            "21875",
            "21830",
            "21826",
            "21837",
            "21849",
            "21822",
            "21874",
            "21850",
            "21856",
            "21840",
            "21865",
            "21861",
            "21814",
            "21803",
            "21802",
            "21810",
            "21852",
            "20906",
            "20878",
            "20874",
            "20902",
            "20904",
            "20850",
            "20852",
            "20854",
            "20910",
            "20817",
            "20877",
            "20901",
            "20815",
            "20886",
            "20853",
            "20814",
            "20879",
            "20876",
            "20912",
            "20832",
            "20903",
            "20871",
            "20895",
            "20905",
            "20855",
            "20816",
            "20866",
            "20882",
            "20841",
            "20872",
            "20851",
            "20833",
            "20837",
            "20842",
            "20860",
            "20861",
            "20818",
            "20880",
            "20896",
            "20899",
            "20862",
            "20868",
            "20839",
            "20838",
            "20812",
            "20894",
            "20913",
            "20915",
            "20914",
            "20918",
            "20916",
            "20997",
            "20993",
            "20047",
            "20058",
            "20076",
            "20207",
            "20810",
            "20811",
            "20813",
            "20847",
            "20849",
            "20848",
            "20859",
            "20875",
            "20825",
            "20824",
            "20830",
            "20827",
            "20885",
            "20884",
            "20889",
            "20892",
            "20897",
            "20898",
            "20908",
            "20907",
            "20911",
            "20883",
            "20857",
            "20891",
            "19720",
            "19702",
            "19711",
            "19709",
            "19701",
            "19805",
            "19808",
            "19713",
            "19802",
            "19810",
            "19977",
            "19803",
            "19804",
            "19801",
            "19734",
            "19703",
            "19707",
            "19809",
            "19806",
            "19938",
            "19889",
            "19807",
            "19887",
            "19716",
            "19706",
            "19717",
            "19730",
            "19732",
            "19736",
            "19733",
            "19731",
            "19890",
            "19892",
            "19891",
            "19894",
            "19893",
            "19896",
            "19895",
            "19898",
            "19897",
            "19899",
            "19708",
            "19710",
            "19712",
            "19715",
            "19714",
            "19718",
            "19725",
            "19721",
            "19726",
            "19735",
            "19880",
            "19850",
            "19885",
            "19884",
            "19886",
            "19904",
            "19901",
            "19977",
            "19963",
            "19934",
            "19962",
            "19943",
            "19952",
            "19938",
            "19950",
            "19946",
            "19953",
            "19954",
            "19964",
            "19979",
            "19902",
            "19936",
            "19903",
            "19905",
            "19906",
            "19955",
            "19961",
            "19980",
            "19966",
            "19958",
            "19973",
            "19947",
            "19963",
            "19956",
            "19968",
            "19971",
            "19945",
            "19933",
            "19975",
            "19960",
            "19939",
            "19970",
            "19950",
            "19940",
            "19941",
            "19930",
            "19951",
            "19967",
            "19944",
            "19931",
            "19969",
            "22204",
            "22201",
            "22207",
            "22202",
            "22203",
            "22229",
            "22205",
            "22223",
            "22206",
            "22234",
            "22218",
            "20231",
            "22209",
            "22213",
            "22211",
            "22214",
            "22222",
            "20598",
            "22210",
            "22212",
            "22215",
            "22217",
            "22216",
            "22219",
            "22226",
            "22225",
            "22227",
            "22230",
            "22241",
            "22240",
            "22243",
            "22242",
            "22245",
            "22244",
            "22246",
            "20301",
            "20310",
            "20330",
            "20350",
            "20453",
            "20406",
            "20147",
            "20148",
            "20176",
            "20164",
            "20175",
            "20152",
            "20165",
            "20105",
            "20151",
            "20132",
            "20166",
            "20180",
            "20141",
            "20158",
            "22093",
            "20135",
            "20117",
            "20197",
            "20184",
            "20129",
            "20149",
            "20107",
            "20101",
            "20103",
            "20102",
            "20104",
            "20118",
            "20131",
            "20134",
            "20142",
            "20146",
            "20159",
            "20163",
            "20160",
            "20167",
            "20177",
            "20178",
            "20189",
            "22193",
            "22191",
            "22192",
            "20110",
            "20109",
            "20155",
            "20111",
            "20136",
            "20112",
            "20169",
            "22026",
            "22025",
            "22172",
            "20181",
            "22134",
            "20137",
            "20143",
            "22125",
            "22194",
            "22195",
            "20156",
            "20168",
            "20182",

            "21617", // client local zip code.
        ];

        $validator = Validator::make($request->all(), [
            'zip_code' => 'required|string|max:5',
        ]);

        if ($validator->fails()) {
            return response()->json([
                'ok' => false,
                'message' => $validator->errors()
            ], 422);
        }

        // $zip = $request->zip_code;
        // $zipExists = ZipCode::where('zip_code', $zip)->exists();

        // if (!$zipExists) {
        if (!in_array($request->zip_code, $zipCodes)) {
            return response()->json([
                'ok' => false,
                'message' => 'Service not available in this ZIP code.'
            ], 422);
        } else {
            return response()->json([
                'ok' => true,
                'message' => 'Service available in this ZIP code.'
            ], 200);
        }
    }

    public function getStates()
    {
        return response()->json([
            'status' => true,
            'message' => 'Get all states',
            'data' => State::select('id','state_name')->get()
        ]);
    }

    public function getCounties(Request $request)
    {
        $stateId = $request->query('state_id');

        return response()->json([
            'status' => true,
            'message' => 'All counties in '.State::where('id',$stateId)->first()->state_name,
            'data' => County::where('state_id', $stateId)->select('id','county_name')->get()
        ]);
    }
}
